language: php

services:
  - docker

env:
  - DOCKER_HUB_REPO=phpmyadmin

before_install:
- docker build --no-cache -t ${DOCKER_HUB_USER}/${DOCKER_HUB_REPO}:self-signed .
- docker run --name phpmyadmin -d -e PMA_ARBITRARY=1 -p 8080:80 ${DOCKER_HUB_USER}/${DOCKER_HUB_REPO}:self-signed 

script:
  - curl 127.0.0.1:8080
  - curl --insecure https://127.0.0.1
  - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_USER" --password-stdin
  - docker push ${DOCKER_HUB_USER}/${DOCKER_HUB_REPO}:self-signed